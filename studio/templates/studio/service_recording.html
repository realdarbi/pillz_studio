{% extends 'studio/service_base.html' %}
{% load static %}

{% block service_params %}
<style>
    .recording-params {
        background: #1a1a1a;
        border-radius: 15px;
        padding: 25px;
        margin-top: 20px;
        border-top: 4px solid #7b2cbf;
    }

    .form-row {
        margin-bottom: 20px;
    }

        .form-row label {
            display: block;
            margin-bottom: 8px;
            color: #00c2cb;
            font-weight: 500;
            font-size: 16px;
        }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        background: #222;
        border: 2px solid #333;
        border-radius: 8px;
        color: white;
        font-size: 16px;
        transition: all 0.3s;
    }

        .form-control:focus {
            border-color: #00c2cb;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 194, 203, 0.2);
        }

    select.form-control {
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300c2cb'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 20px;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        margin: 15px 0;
    }

        .checkbox-group input {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            accent-color: #7b2cbf;
        }

        .checkbox-group label {
            margin: 0;
            color: white;
            font-weight: normal;
        }

    .price-display {
        background: #7b2cbf;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        margin: 20px 0;
        font-weight: bold;
        text-align: center;
        display: none;
    }

    /* Кастомный datetime input */
    input[type="datetime-local"] {
        position: relative;
    }

        input[type="datetime-local"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            opacity: 0.7;
            cursor: pointer;
        }
</style>

<div class="recording-params">
    <div class="form-row">
        {{ params_form.recording_type.label_tag }}
        {{ params_form.recording_type }}
    </div>

    <div class="form-row">
        {{ params_form.hours.label_tag }}
        {{ params_form.hours }}
        <div class="checkbox-group unknown-hours">
            {{ params_form.unknown_hours }}
            {{ params_form.unknown_hours.label_tag }}
        </div>
    </div>

    <div class="checkbox-group sound-engineer">
        {{ params_form.sound_engineer }}
        {{ params_form.sound_engineer.label_tag }}
    </div>

    <div class="form-row">
        {{ params_form.datetime.label_tag }}
        {{ params_form.datetime }}
    </div>

    <div class="price-display" id="priceDisplay">
        Примерная стоимость: <span id="calculatedPrice">{{ service.min_price }}</span> ₽
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const basePrice = {{ service.min_price }};
    const priceDisplay = document.getElementById('priceDisplay');
    const calculatedPrice = document.getElementById('calculatedPrice');
    const hoursInput = document.getElementById('id_hours');
    const unknownCheckbox = document.getElementById('id_unknown_hours');
    const soundEngineerCheckbox = document.getElementById('id_sound_engineer');

    function updatePrice() {
        let price = basePrice;
        const hours = parseInt(hoursInput.value) || 0;

        if (!unknownCheckbox.checked && hours >= 3) {
            price += hours * 500;
        }

        if (!soundEngineerCheckbox.checked) {
            price -= 200;
        }

        calculatedPrice.textContent = price;
        priceDisplay.style.display = 'block';
    }

    hoursInput.addEventListener('change', updatePrice);
    unknownCheckbox.addEventListener('change', updatePrice);
    soundEngineerCheckbox.addEventListener('change', updatePrice);

    // Инициализация при загрузке
    updatePrice();
});
</script>
{% endblock %}